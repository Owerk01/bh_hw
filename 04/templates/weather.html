{% extends "base.html" %}

{% block title %}–ü–æ–≥–æ–¥–∞ ‚Äî My Web App{% endblock %}

{% block content %}
<div style="max-width: 800px; margin: 0 auto;">
    <h2>–£–∑–Ω–∞—Ç—å –ø–æ–≥–æ–¥—É</h2>
    <p style="color: #666; margin-bottom: 1.5rem;">
        –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: <em>Minsk, London, Tokyo</em>).
    </p>

    <form method="post" style="margin-bottom: 2rem;">
        <div style="display: flex; gap: 10px; flex-wrap: wrap; align-items: center;">
            <input 
                type="text" 
                name="city" 
                placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Minsk, Paris, Tokyo"
                value="{{ request.form.city or '' }}" 
                required
                style="flex: 1; min-width: 200px; padding: 10px; border: 1px solid #ccc; border-radius: 6px; font-size: 1rem;"
            >
            <button type="submit" 
                    style="padding: 10px 20px; background: #3498db; color: white; border: none; border-radius: 6px; font-weight: bold;">
                –ü–æ–∫–∞–∑–∞—Ç—å
            </button>
        </div>
    </form>

    {% if error %}
        <div class="error" style="margin: 1.5rem 0; padding: 12px; background: #ffebee; border-left: 4px solid #f44336; border-radius: 6px; color: #c62828;">
            {{ error }}
        </div>
    {% endif %}

    {% if city %}
        <h3 style="margin: 2rem 0 1rem;">–ü–æ–≥–æ–¥–∞ –≤ –≥–æ—Ä–æ–¥–µ: <em>{{ city|title }}</em></h3>

        {% if is_minsk %}
            <div style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); margin: 1.5rem 0;">
                <h4 style="margin-bottom: 15px; color: #2c3e50;">üå¶Ô∏è –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –≤–∏–¥–∂–µ—Ç OpenWeatherMap (–ú–∏–Ω—Å–∫)</h4>
                
                <div style="overflow-x: auto; padding: 10px 0;">
                    <div id="openweathermap-widget-1" style="min-width: 600px;"></div>
                </div>
            </div>

            <link rel="stylesheet" href="//openweathermap.org/themes/openweathermap/assets/vendor/owm/css/style.min.css">
            <script src="//unpkg.com/d3@7.8.5/dist/d3.min.js"></script>
            <script type="text/javascript">
                window.myWidgetParam = window.myWidgetParam || [];
                window.myWidgetParam.push({
                    id: 1,
                    cityid: '625144',
                    appid: '{{WEATHER_API_KEY}}', 
                    units: 'metric',
                    containerid: 'openweathermap-widget-1'
                });
                (function() {
                    var script = document.createElement('script');
                    script.async = true;
                    script.charset = "utf-8";
                    script.src = "//openweathermap.org/themes/openweathermap/assets/vendor/owm/js/weather-widget-generator-2.0.js";
                    document.head.appendChild(script);
                })();
            </script>

        {% elif weather %}
            <div style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); margin: 1.5rem 0;">
                <div style="display: flex; align-items: center; gap: 20px; flex-wrap: wrap;">
                    {% if weather.icon %}
                        <img 
                            src="https://openweathermap.org/img/wn/{{ weather.icon }}@2x.png" 
                            alt="–ò–∫–æ–Ω–∫–∞ –ø–æ–≥–æ–¥—ã"
                            style="width: 80px; height: 80px;"
                        >
                    {% endif %}
                    <div>
                        <p style="font-size: 2rem; font-weight: bold; margin: 0;">{{ weather.temp_c }}¬∞C</p>
                        <p style="color: #555; margin: 5px 0;">{{ weather.description|capitalize }}</p>
                    </div>
                </div>

                <div style="margin-top: 20px; display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                    <div><strong>–û—â—É—â–∞–µ—Ç—Å—è –∫–∞–∫:</strong> {{ weather.feels_like_c }}¬∞C</div>
                    <div><strong>–í–ª–∞–∂–Ω–æ—Å—Ç—å:</strong> {{ weather.humidity }}%</div>
                    <div><strong>–î–∞–≤–ª–µ–Ω–∏–µ:</strong> {{ weather.pressure }} –≥–ü–∞</div>
                    <div><strong>–í–µ—Ç–µ—Ä:</strong> {{ weather.wind_speed }} –º/—Å</div>
                    <div><strong>–í–∏–¥–∏–º–æ—Å—Ç—å:</strong> {{ (weather.visibility / 1000)|round(1) }} –∫–º</div>
                    <div><strong>–°—Ç—Ä–∞–Ω–∞:</strong> {{ weather.country }}</div>
                </div>
            </div>
        {% endif %}
    {% endif %}

    <p style="text-align: center; margin-top: 2rem; color: #777;">
        <a href="{{ url_for('index') }}">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é</a>
    </p>
</div>
{% endblock %}